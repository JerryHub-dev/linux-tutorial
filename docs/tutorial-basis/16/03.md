# 进程管理

为什么进程管理这么重要？是因为：

- 我们在操作系统时的各项工作都是经过某个 PID 来达成的（包括你的 bash 环境），因此，能不能进行某项工作，与该进程的权限有关
- 如果你的 LInux 是个很忙碌的系统，当整个系统资源要被使用光的时候，你是否能够找出最耗资源的哪个进程，然后删除该进程，让系统恢复正常？
- 由于某个程序写的不好，导致产生一个有问题的进程在内存中，如何找出它，将它移除呢？
- 如果有 5、6 项工作在系统中运行，但其中有一项工作才是最重要的，该如何让那一项重要的工作被最优先执行？

以上几点，在系统使用中都是很重要且常见的问题

## 进程的观察

### ps：将某个时间点的进程运行情况截取下来

```bash
ps aux		# 观察系统所有的进程数据
ps -lA 		# 观察系统所有的进程数据
ps axjf		# 连同部分进程树状态

选项与参数：
	-A：所有的 process 都显示出来，与 -e 具有同样的效果
	-a：不与 terminal 有关的所有 process
	-u：有效使用者（effective user）相关的 process
	x：通常与 a 一起使用，可列出完整信息
输出格式规划：
	l：较长、较详细的将该 PID 的信息列出
	j：工作的格式（jobs format）
	-f：做一个更为完整的输出
```

ps 指令的 man page 不太好查阅，不同的 Unix 都使用 ps 来查阅进程状态，为了符合不同版本的需求，该 man page 写的非常庞大，因此建议你有两个选择：

1. 只能查询自己 bash 进程的 `ps -l`
2. 可以查询所有系统运行的进程 `ps aux`

### 仅查看自己的 bash 相关进程：`ps -l`

```bash
# 范例 1： 将目前属于您自己这次登录的 PID 与相关信息列出来（只与自己的 bash 有关）
[root@study ~]# ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
4 S     0 29260 28796  0  80   0 - 57972 do_wai pts/0    00:00:00 su
4 S     0 29473 29260  0  80   0 - 29090 do_wai pts/0    00:00:00 bash
0 R     0 30444 29473  0  80   0 - 12407 -      pts/0    00:00:00 ps
# 前面三项，最初是用了普通账户登录的，使用了 su - 切换到了一个 bash
```

这里列出的只是与你操作环境 bash 有关的进程，没有延伸到 systemd（后续交代）：

- F：进程旗标（process flags），说明这个进程的总结权限，常见的号码有：
  - 4：表示此进程的权限为 root
  - 1：则表示此子进程仅进行 **复制（fork）而没有实际执行（exec）**
- S：进程状态（STAT），主要状态有：
  - R（Running）：正在运行中
  - S（Sleep）：该程序目前正在睡眠状态（idle），但可以被唤醒（signal）
  - D：不可被唤醒的睡眠状态，通常该程序可能在等待 I/O 的情况
  - T：停止状态（stop），可能是在工作控制（背景暂停）或除错（traced）状态
  - Z（Zombie）：僵尸状态，进程已终止但却无法被移除至内存外
- UUID/PID/PPID：代表此进程被该 UID 所拥有、进程的 PID 、此进程的父进程 PID
- C：代表 CPU 使用率，单位为百分比
- PRI/NI：Priority/Nice 的缩写，代表此进程被 CPU 所执行的优先级，数值越小表示该进程越快被 CPU 执行。详细的 PRI 与 NI 将在下一小节讲解
- ADDR/SZ/WCHAN：都与内存有关
  - ADDR：kernel function，该进程在内存的哪个部分，如果是 running 的进程，一般会显示 `-`
  - SZ：该进程用掉多少内存
  - WCHAN 该进程是否运行中，若为 `-` 表示正在运行中
- TTY：登陆者的终端机位置，若为远程登录则使用动态终端接口（pts/n）
- TIME：使用掉的 CPU 时间。注意：是此进程实际花费 CPU 运行的时间
- CMD：command 的缩写，此进程的触发程序指令

如上列出的信息表示， bash 的程序属于 UID 为 0 的使用者，状态是睡眠（sleep），他睡眠是因为他触发了 ps（状态为 R，run）的原因，ps 的 PID=30444，优先执行顺序为 80，下达 bash 所取得的终端机接口为 pts/0，运行状态为 do_wai

### 观察系统所有进程：ps aux